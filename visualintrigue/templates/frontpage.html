<!DOCTYPE html>
<html>
  <head>
    <title>{{ title }}</title>
    <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
    <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tether/1.1.1/css/tether-theme-arrows.css" />
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/static/css/site.css" />
    <script src="https://use.fontawesome.com/df0741c26d.js"></script>
    <script type="text/javascript">
    // Google Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-57579922-2', 'auto');
    ga('send', 'pageview');   
    </script>
  </head>
  <body class="frontpage">
    <nav class="navbar navbar-dark bg-inverse navbar-fixed-top">
      <ul class="nav navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About <span class="sr-only">(current)</span></a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right pull-xs-right">
        {% if current_user.is_authenticated %}
        <li class="nav-item">
          <a class="nav-link" href="/collection/list">Manage Collections <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('logout') }}">LogOut [ {{ current_user.id }} ] <span class="sr-only">(current)</span></a>
        </li>
        {% else %}
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('login') }}">Log In <span class="sr-only">(current)</span></a>
        </li>
        {% endif %}        
      </ul>
    </nav>
      
    <div class="container-fluid">
      <div class="jumbotron-fluid vi-jumbo">
        <div class="vi-jumbo-center home-pattern">
        <h1 class="display-3">Visual Intrigue</h1>
        <p class="lead">Sharing adventures one picture at a time!</p>
        </div>
      </div>
      
      <div class="row">
        <div class="col-sm-12 fp-header frosty home-pattern">
          <h3>Photos by Categories</h3>
          <hr/>
          <ul class="list-unstyled pinfo-list portfolio-items">
            <li><i class="fa fa-camera-retro fa-lg"></i>&nbsp;<a href="/portfolio/landscape">Landscape</a></li>
            <li><i class="fa fa-camera-retro fa-lg"></i>&nbsp;<a href="/portfolio/cityscapes">Cityscapes</a></li>
            <li><i class="fa fa-camera-retro fa-lg"></i>&nbsp;<a href="/portfolio/macro">Macro</a></li>
            <li><i class="fa fa-camera-retro fa-lg"></i>&nbsp;<a href="/portfolio/street">Street</a></li>

          </ul>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12 fp-header frosty home-pattern" style="padding-top:30px;">
          <h3>Read the Stories</h3>
          <hr />
        </div>
      </div>
      <div class="grid">
      <div class="grid-sizer"></div>
 
 {% for blog in blogs %}
 {% if 'lrmedium' in blog['files'] %}
  <div class="grid-item" id="{{blog['slug']}}">
    <a class="pinfo-title" href="/stories/{{blog['cslug']}}">
      <img style="width:{{blog['files']['medium']['width']}}px;" 
           data-src="{{baseurl}}{{ blog['files']['medium']['path']}}"
           src="{{baseurl}}{{ blog['files']['lrmedium']['path']}}"
           alt="{{blog['title']}}"/>
    </a>
    <div class="pinfo home-pattern" id="{{blog['cslug']}}">
      <div class="button-bar">
        <a class="pinfo-title" href="/stories/{{blog['cslug']}}">{{blog['ctitle']}}</a>
        <hr />
        <p>
          {{ blog['summary'] }} 
        </p>
      </div>      
    </div>
  </div>
  {% endif %}
  {% endfor %}

</div>     
    <script src="https://code.jquery.com/jquery-2.2.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.1.1/js/tether.js"></script>
    <script src="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/js/bootstrap.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" crossorigin="anonymous"></script>
    <script src="https://npmcdn.com/masonry-layout@4.1/dist/masonry.pkgd.min.js"></script>
    <script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>
    <script src="/static/js/bgswitcher.js"></script>
    <script type="text/javascript">
      
    // external js: masonry.pkgd.js, imagesloaded.pkgd.js
    
    // init Isotope
    var grid = document.querySelector('.grid');
    var fparray = []
    var fptimer
    var current_image = 0
    
    var msnry = new Masonry( grid, {
      itemSelector: '.grid-item',
      columnWidth: '.grid-sizer',
      percentPosition: true
    });
    
    imagesLoaded( grid ).on( 'progress', function() {
      // layout Masonry after each image loads
      msnry.layout();
    });
    console.log("Done");
    
    $("div.grid-item").mouseover(function() {
      console.log("mouse me baby");
      console.log($(this).parent().width())
      if ($(this).parent().width() > 1024 ) {
        var pinfo = $(this).children('div.pinfo').eq(0);
        pinfo.show();
      }
    });
    
    $("div.grid-item").mouseout(function() {
      console.log("mouse out baby");
      var pinfo = $(this).children('div.pinfo').eq(0);
      pinfo.hide();
    });
    
    $("div.grid-item").click(function() {
      var pinfo = $(this).children('div.pinfo');
      var id = pinfo.attr('id');
      window.location.href = "/stories/" + id;
    });
        
    $( document ).ready(function() {
      var fpAPI = "/image/frontpageservice";
      $.getJSON( fpAPI, {
        //tags: "mount rainier",
        //tagmode: "any",
        format: "json"
      })
      .done(function( data ) {
        $.each( data.urls, function( i, url ) {
          //$( "<img>" ).attr( "src", item.media.m ).appendTo( "#images" );
          //if ( i === 3 ) {
          //  return false;
          //}
          fparray.push(url.url)
          console.log("Image: " + url.url)
          
        });
      });
      //fptimer = setInterval(function(){ frontater() }, 10000);
    });
    
    //function frontater() {
    //  console.log('rotating');
    //  body = $('body');
    //  
    //  body.css('background','url('+ fparray[current_image] +') no-repeat center center fixed');
    //  body.css('background-size','cover');
    //  current_image = current_image + 1;
    //  console.log(fparray.length + " " + current_image);
    //  if (current_image > fparray.length-1) {
    //    current_image = 0;
    //    preloadImage(fparray[current_image + 1])
    //  }
    //}
    
    $(".frontpage").bgswitcher({
      //images: ["pic1.jpg", "pic2.jpg", "pic3.jpg"],
      images: fparray,
      loop: true,
      interval: 5000,
      shuffle: true,
    });
    
    function preloadImage(url){
        var img=new Image();
        img.src=url;
    }
    
    </script>
      

  </body>
</html>
